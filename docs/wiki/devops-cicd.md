# DevOps and CI/CD

This project uses a staged quality model with required check enforcement and docs deployment.

## Local Developer Workflow

Use either `task` or `just` from project root:

- `task preflight` or `just preflight`: verify required tools.
- `task quality:quick` or `just quality-quick`: typecheck, lint, unit tests.
- `task quality:strict` or `just quality-strict`: quick lane + coverage + docs build.
- `task ci` or `just ci`: strict lane plus doc index generation.

## CI Pipelines

GitHub Actions workflows:

- `.github/workflows/ci.yml`: required baseline checks (typecheck, lint, unit, coverage, secret scan).
- `.github/workflows/stage-gates.yml`: branch-stage aware gates for PRs.
- `.github/workflows/policy-gate.yml`: enforces merge-policy constraints.
- `.github/workflows/required-check-names-guard.yml`: validates required check manifest stays aligned.
- `.github/workflows/agent-dir-guard.yml`: enforces allowed agent-directory files in tracked repository content.
- `.github/workflows/vitepress-pages.yml`: builds and deploys VitePress docs on `main`.

## Required Check Governance

Branch protection should use names from `.github/required-checks.txt`.

When adding/removing CI jobs:

1. Update the workflow job `name` values.
2. Update `.github/required-checks.txt` in the same pull request.
3. Ensure `required-check-names-guard` stays green.

## Agent Directory Policy

Agent directories (`.claude/`, `.codex/`, `.gemini/`, `.cursor/`, `.qwen/`,
`.opencode/`, `.windsurf/`, `.kilocode/`, `.augment/`, `.roo/`, `.amazonq/`)
are blocked by default. The only allowlisted paths are:

- `.claude/skills/**`
- `.claude/commands/*.md`
- `.codex/prompts/*.md`
- `.cursor/commands/*.md`
- `.gemini/config.yaml`
- `.gemini/commands/*.toml`

Additionally, `.github/copilot/**` is blocked by policy.

Any other file under agent directories must not be committed.

## Docs Index

The docs index is generated by `docs/scripts/generate-doc-index.sh` and written to:

- `docs/index/raw-all.md`
- `docs/index/planning.md`
- `docs/index/specs.md`
- `docs/index/research.md`
- `docs/index/worklogs.md`
- `docs/index/other.md`
- `docs/.generated/doc-index.json`

The generator excludes transient paths such as `node_modules`, `dist`, `.generated`, and `.worktrees`.
